# Rideau Canal Monitoring Dashboard

## 1. Overview

This repository contains the **web dashboard** for the Rideau Canal Skateway real-time monitoring system.
The dashboard displays:

- Latest conditions for each monitoring location
- Safety status (Safe / Caution / Unsafe)
- Historical trend charts (last 1 hour of data)
- Auto-refreshing updates

The dashboard queries **Azure Cosmos DB**, which stores 5-minute aggregated results generated by **Azure Stream Analytics.**

**Technologies Used**

- Node.js + Express (backend API)
- HTML, CSS, JavaScript (frontend)
- Chart.js (visualizations)
- Azure Cosmos DB SDK for Node
- Environment configuration with `dotenv`

---

## 2. Prerequisites

Before running the dashboard, ensure you have:

- Node.js 18+ or 20+ installed
- An active Cosmos DB account with:
  - Database: RideauCanalDB
  - Container: SensorAggregations
  - Data from Stream Analytics already flowing
- .env file configured with your Cosmos DB credentials

---

## 3. Installation

```
git clone https://github.com/shap0011/25F_CST8916_Final_Project_Web-Dashboard.git
cd 25F_CST8916_Final_Project_Web-Dashboard

npm install
```

## 4. Configuration

Create a `.env` file in the project root:

```
cp .env.example .env
```

Open .env and set the values:

```
PORT=3000

COSMOS_ENDPOINT=https://<your-cosmos-account>.documents.azure.com:443/
COSMOS_KEY=<your-cosmos-primary-key>
COSMOS_DATABASE=RideauCanalDB
COSMOS_CONTAINER=SensorAggregations
```

You can find these in Azure Portal under:

**Cosmos DB → Keys → Primary Key / Primary Endpoint**

---

## 5. Usage

**Start the dashboard locally:**

```
npm start
```

The server will run at:

```
http://localhost:3000/
```

Open the dashboard in your browser to view:

- Real-time telemetry
- Location cards with safety status
- Trend charts for ice thickness, surface temperature, etc.

---

## 6. API Endpoints

### GET /api/latest

Returns the most recent aggregated document for each location.

**Sample Response:**

```
{
  "success": true,
  "data": [
    {
      "location": "dows-lake",
      "avgIceThicknessCm": 31.5,
      "safetyStatus": "Safe",
      "windowEndTime": "2025-12-08T03:40:00Z"
    }
  ]
}
```

---

### GET /api/history/:location

Returns historical data for a specific location.

Example:

```
/api/history/dows-lake
/api/history/fifth-avenue
/api/history/nac
```

### GET /api/status

Returns the overall system status and latest status for each location.

### GET /api/all

Debug endpoint — returns **all documents** from Cosmos DB (sorted by time).

---

## 7. Deployment to Azure App Service

> Note: Azure App Service was attempted but encountered diagnostic extension errors and quota limits on Azure for Students. The dashboard works fully **locally.**

### Steps (summarized)

1. Create a new Node.js App Service
2. Add environment variables under Configuration → Application settings
3. Deploy using:

   - ZIP Deploy (OneDeploy), or
   - GitHub Actions

4. Restart the web app

Due to platform limitations, the deployed version encountered:

- `Application Error`
- Diagnostic extension failure (`Forbidden`)
- App Service plan `Quota exceeded`

These issues are documented in the main assignment submission.

---

## 9. Troubleshooting

### Dashboard shows "Loading..." forever

- Ensure `/api/latest` and `/api/status` return data
- Verify `.env` has correct Cosmos DB endpoint/key
- Verify Stream Analytics is running

### Charts show "No history data to plot"

- Make sure your simulator is running
- Check Cosmos DB for new documents
- Stream Analytics requires **5 minutes** per window before data appears

### `Application Error` on Azure

- Caused by App Service diagnostic extension failure
- Also triggered by free-tier quota limits

---

## 10. Notes

- Dashboard refreshes automatically every 30 seconds
- Historical charts show the last 12 aggregated windows (≈1 hour)
- Safety logic is computed by Stream Analytics, not by the dashboard
